var Soportes={};(function(){this.init=function(){$("#tabla_soportes").DataTable({destroy:!0,language:{url:baseUrl+"assets/lib/DataTables-1.10.8/Spanish.json"},order:[[0,"desc"]]})},this.nuevoSoporte=function(){},this.enviarSoporte=function(e,o){var t=$(o).html();$(o).attr("disabled",!0).html('Enviando...<i class="fa fa-spin fa-spinner"></i>');var a="";if(""==e.asunto_soporte.value&&(a+="- Debe ingresar el asunto del ticket<br/>"),""==e.texto_soporte.value&&(a+="- Debe ingresar el texto del ticket<br/>"),""!=a)bootbox.alert({title:"Error",message:a}),$(o).attr("disabled",!1).html(t);else{var r=$(e).serialize();$.post(siteUrl+"soportes/enviarSoporte",{data:r},function(e){1==e.estado?bootbox.dialog({title:"Ingreso correcto",message:e.mensaje,buttons:{ok:{callback:function(){$(o).attr("disabled",!1).html(t),ModalSipresa.close_modal("modal_nuevo_soporte"),$.post(siteUrl+"soportes/cargarGrillaSoportes",{grilla:"usuario"},function(e){$("#contenedor-tabla-soportes").html(e),Soportes.init()},"html").fail(function(){bootbox.alert({title:"Error",message:"Hubo un error en el sistema. Intente nuevamente o comuníquese con Administrador"})})}}}}):(bootbox.alert({title:"Error",message:e.mensaje}),$(o).attr("disabled",!1).html(t))},"json").fail(function(){bootbox.dialog({title:"Error",message:"Hubo un error en el sistema. Intente nuevamente o comuníquese con Administrador"}),$(o).attr("disabled",!1).html(t)})}},this.enviarMensaje=function(e,o){var t=$(o).html();$(o).attr("disabled",!0).html('Enviando...<i class="fa fa-spin fa-spinner"></i>');var a="";if(""==e.texto_mensaje.value&&(a+="- Debe ingresar el texto del mensaje<br/>"),""!=a)bootbox.alert({title:"Error",message:a}),$(o).attr("disabled",!1).html(t);else{var r=$(e).serialize();$.post(siteUrl+"soportes/enviarMensaje",{data:r},function(e){1==e.estado?bootbox.dialog({title:"Envio correcto",message:e.mensaje,buttons:{ok:{callback:function(){$(o).attr("disabled",!1).html(t),ModalSipresa.close_modal("modal_nuevo_mensaje"),ModalSipresa.close_modal("modal_ver_soporte")}}}}):(bootbox.alert({title:"Error",message:e.mensaje}),$(o).attr("disabled",!1).html(t))},"json").fail(function(){bootbox.dialog({title:"Error",message:"Hubo un error en el sistema. Intente nuevamente o comuníquese con Administrador"}),$(o).attr("disabled",!1).html(t)})}},this.cerrarTicket=function(e,o){bootbox.confirm("Desea cerrar el ticket "+o,function(o){1==o&&$.post(siteUrl+"soportes/cerrarSoporte",{soporte:e},function(e){1==e.estado?bootbox.dialog({title:"Ticket Cerrado",message:e.mensaje,buttons:{ok:{callback:function(){ModalSipresa.close_modal("modal_ver_soporte"),$.post(siteUrl+"soportes/cargarGrillaSoportes",{grilla:"soporte"},function(e){$("#contenedor-tabla-soportes").html(e),Soportes.init()},"html").fail(function(){bootbox.alert({title:"Error",message:"Hubo un error en el sistema. Intente nuevamente o comuníquese con Administrador"})})}}}}):bootbox.alert({title:"Error",message:e.mensaje})},"json").fail(function(){bootbox.dialog({title:"Error",message:"Hubo un error en el sistema. Intente nuevamente o comuníquese con Administrador"})})})},this.cargarGrillaAdjuntos=function(){$.post(siteUrl+"soportes/cargarGrillaAdjuntos",function(e){$("#contenedor-adjuntos").html(e)},"html").fail(function(){bootbox.dialog({title:"Error",message:"Hubo un error en el sistema. Intente nuevamente o comuníquese con Administrador"})})},this.sacarAdjunto=function(e){$.post(siteUrl+"soportes/sacarAdjunto",{adjunto:e},function(e){1==e.estado?Soportes.cargarGrillaAdjuntos():bootbox.alert({title:"Error",message:"No se ha podido eliminar el adjunto. Intente nuevamente"})},"json").fail(function(){bootbox.dialog({title:"Error",message:"Hubo un error en el sistema. Intente nuevamente o comuníquese con Administrador"})})}}).apply(Soportes);