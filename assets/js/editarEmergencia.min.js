var Emergencia={};(function(){this.inicio=function(){var e=$("#eme_ia_id").val();$("#iTiposEmergencias").jCombo(siteUrl+"emergencia/jsonTiposEmergencias"),$("#iComunas").jCombo(siteUrl+"session/obtenerJsonComunas",{handlerLoad:function(){$.getJSON(siteUrl+"emergencia/getEmergencia/id/"+e,function(e){var a=e.comunas;if(null!==a){var i=a.split(",");$("#iComunas").picklist({value:i})}else $("#iComunas").picklist();$("#eme_ia_id").val(e.eme_ia_id),$("#ala_ia_id").val(e.ala_ia_id),$("#iNombreInformante").val(e.eme_c_nombre_informante),$("#iTelefonoInformante").val(e.eme_c_telefono_informante),$("#iNombreEmergencia").val(e.eme_c_nombre_emergencia),$("#iTiposEmergencias").val(e.tip_ia_id),$("#iLugarEmergencia").val(e.eme_c_lugar_emergencia),$("#fechaEmergencia").val(e.eme_d_fecha_emergencia),$("#usuarioRecepciona").val(e.usuario),$("#fechaRecepcion").val(e.eme_d_fecha_recepcion),$("#iObservacion").val(e.eme_c_observacion),Emergencia.dibujaTablaDocs(),Emergencia.iniciarUpload()})},initial_text:null}),$("#fechaEmergencia, #fechaRecepcion").datetimepicker({format:"DD-MM-YYYY hh:mm"}),$("#iDocMaterial").on("filebatchuploadcomplete",function(){Emergencia.dibujaTablaDocs()})},this.inicioListado=function(){$("#iTiposEmergencias").jCombo(siteUrl+"emergencia/jsonTiposEmergencias"),$("#btnBuscar").click(this.eventoBtnBuscar),$(window).resize(function(){$("table").css("width","100%")})},this.eventoBtnBuscar=function(){var e=siteUrl+"emergencia/jsonEmergenciasDT",a=$("#iAnio").val(),i=$("#iTiposEmergencias").val();parseInt(a)&&(e+="/anio/"+a),parseInt(i)&&(e+="/tipoEmergencia/"+i);var l=$("#tblEmergencias").DataTable();l.destroy(),$("#tblEmergencias").empty(),$.get(e).done(function(e){var a=JSON.parse(e);a.columns[0].mRender=function(e,a,i){var l="";return l+='<div class="col-md-12 shadow" style="padding: 10px;">',l+='    <div class="col-md-2 text-center"><img src="'+baseUrl+'assets/img/quimico_ico.png"/></div>',l+='    <div class="col-md-8">',l+='        <div class="form-group col-md-12">',l+='            <label for="" class="col-md-4 control-label">Fecha de la emergencia:</label>',l+='            <div class="col-md-8">',l+="                <p>"+i.eme_d_fecha_emergencia+"</p>",l+="            </div>",l+="        </div>",l+='        <div class="form-group col-md-12">',l+='            <label for="" class="col-md-4 control-label">Nombre de la emergencia:</label>',l+='            <div class="col-md-8">',l+="                <p>"+i.eme_c_nombre_emergencia+"</p>",l+="            </div>",l+="        </div>",l+='        <div class="form-group col-md-12">',l+='            <label for="" class="col-md-4 control-label">Tipo de la emergencia:</label>',l+='            <div class="col-md-8">',l+="                <p>"+i.eme_c_tipo_emergencia+"</p>",l+="            </div>",l+="        </div>",l+='        <div class="form-group col-md-12">',l+='            <label for="" class="col-md-4 control-label">Lugar de la emergencia:</label>',l+='            <div class="col-md-8">',l+="                <p>"+i.eme_c_lugar_emergencia+"</p>",l+="            </div>",l+="        </div>",l+="    </div>",l+='    <div class="col-md-2 text-center">',l+='       <div class="btn-group">',l+='           <a title="Editar" class="btn btn-default" onclick=Emergencia.editarEmergencia('+i.eme_ia_id+");>",l+='               <i class="fa fa-pencil"></i>',l+="           </a>",l+='           <a title="Eliminar" class="btn btn-default">',l+='               <i class="fa fa-trash"></i>',l+="           </a>",l+="       </div>",l+="    </div>",l+="</div>"},$("#tblEmergencias").DataTable({data:a.data,columns:a.columns,language:{url:baseUrl+"assets/lib/DataTables-1.10.8/Spanish.json"},order:[[0,"desc"]]}),$("#pResultados").css("visibility","visible"),$("#pResultados").slideDown("slow")})},this.guardarForm=function(){if(!Utils.validaForm("frmEditarEmergencia"))return!1;var e=$("#frmEditarEmergencia").serialize();$.post(siteUrl+"emergencia/editarEmergencia",e,function(e){1==e?bootbox.dialog({title:"Resultado de la operacion",message:"Se ha editado correctamente",buttons:{danger:{label:"Cerrar",className:"btn-info",callback:function(){location.reload()}}}}):bootbox.dialog({title:"Resultado de la operacion",message:"Error al editar",buttons:{danger:{label:"Cerrar",className:"btn-danger"}}})})},this.limpiar=function(){$("#frmEditarEmergencia")[0].reset(),$("#iComunas").picklist("destroy"),$("#iComunas").picklist()},this.iniciarUpload=function(){var e=$("#ala_ia_id").val();$("#iDocMaterial").fileinput({language:"es",uploadUrl:siteUrl+"archivo/subir/tipo/5/id/"+e,uploadAsync:!0,multiple:!0,initialCaption:"Seleccione archivos y luego presione subir",allowedFileTypes:["image","html","text","video","audio","flash","object"]})},this.dibujaTablaDocs=function(){var e=$("#ala_ia_id").val();$("#tabla_doc").dataTable().fnDestroy(),$("#tabla_doc").dataTable({ajax:{url:siteUrl+"archivo/getDocs/id/"+e+"/tipo/5",type:"POST",async:!0},language:{url:baseUrl+"assets/lib/DataTables-1.10.8/Spanish.json"},aoColumns:[null,null,null,{sClass:"text-center"}]}),$("#tabla_doc").wrap("<div class='col-sm-12' style='padding-left:0px !important;'></div>")}}).apply(Emergencia);