var EmergenciaEditar={};(function(){this.inicio=function(){var a=$("#eme_ia_id").val();console.log(a),$("#iTiposEmergencias").jCombo(siteUrl+"emergencia/jsonTiposEmergencias"),$("#iComunas").jCombo(siteUrl+"session/obtenerJsonComunas",{handlerLoad:function(){$.getJSON(siteUrl+"emergencia/getEmergencia/id/"+a,function(a){var e=a.comunas;if(null!==e){var i=e.split(",");$("#iComunas").picklist({value:i})}else $("#iComunas").picklist();$("#eme_ia_id").val(a.eme_ia_id),$("#ala_ia_id").val(a.ala_ia_id),$("#iNombreInformante").val(a.eme_c_nombre_informante),$("#iTelefonoInformante").val(a.eme_c_telefono_informante),$("#iNombreEmergencia").val(a.eme_c_nombre_emergencia),$("#iTiposEmergencias").val(a.tip_ia_id),$("#iLugarEmergencia").val(a.eme_c_lugar_emergencia),$("#fechaEmergencia").val(a.eme_d_fecha_emergencia),$("#usuarioRecepciona").val(a.usuario),$("#fechaRecepcion").val(a.eme_d_fecha_recepcion),$("#iObservacion").val(a.eme_c_observacion),EmergenciaEditar.dibujaTablaDocs(),EmergenciaEditar.iniciarUpload()})},initial_text:null}),$("#fechaEmergencia, #fechaRecepcion").datetimepicker({format:"DD-MM-YYYY hh:mm"}),$("#iDocMaterial").on("filebatchuploadcomplete",function(){EmergenciaEditar.dibujaTablaDocs()})},this.inicioListado=function(){$("#iTiposEmergencias").jCombo(siteUrl+"emergencia/jsonTiposEmergencias"),$("#btnBuscar").click(this.eventoBtnBuscar),$(window).resize(function(){$("table").css("width","100%")})},this.eventoBtnBuscar=function(){var a=siteUrl+"emergencia/jsonEmergenciasDT",e=$("#iAnio").val(),i=$("#iTiposEmergencias").val();parseInt(e)&&(a+="/anio/"+e),parseInt(i)&&(a+="/tipoEmergencia/"+i);var l=$("#tblEmergencias").DataTable();l.destroy(),$("#tblEmergencias").empty(),$.get(a).done(function(a){var e=JSON.parse(a);e.columns[0].mRender=function(a,e,i){var l="";return l+='<div class="col-md-12 shadow" style="padding: 10px;">',l+='    <div class="col-md-2 text-center"><img src="'+baseUrl+'assets/img/quimico_ico.png"/></div>',l+='    <div class="col-md-8">',l+='        <div class="form-group col-md-12">',l+='            <label for="" class="col-md-4 control-label">Fecha de la emergencia:</label>',l+='            <div class="col-md-8">',l+="                <p>"+i.eme_d_fecha_emergencia+"</p>",l+="            </div>",l+="        </div>",l+='        <div class="form-group col-md-12">',l+='            <label for="" class="col-md-4 control-label">Nombre de la emergencia:</label>',l+='            <div class="col-md-8">',l+="                <p>"+i.eme_c_nombre_emergencia+"</p>",l+="            </div>",l+="        </div>",l+='        <div class="form-group col-md-12">',l+='            <label for="" class="col-md-4 control-label">Tipo de la emergencia:</label>',l+='            <div class="col-md-8">',l+="                <p>"+i.eme_c_tipo_emergencia+"</p>",l+="            </div>",l+="        </div>",l+='        <div class="form-group col-md-12">',l+='            <label for="" class="col-md-4 control-label">Lugar de la emergencia:</label>',l+='            <div class="col-md-8">',l+="                <p>"+i.eme_c_lugar_emergencia+"</p>",l+="            </div>",l+="        </div>",l+="    </div>",l+='    <div class="col-md-2 text-center">',l+='       <div class="btn-group">',l+='           <a title="Editar" class="btn btn-default" onclick=EmergenciaEditar.editarEmergencia('+i.eme_ia_id+");>",l+='               <i class="fa fa-pencil"></i>',l+="           </a>",l+='           <a title="Eliminar" class="btn btn-default">',l+='               <i class="fa fa-trash"></i>',l+="           </a>",l+="       </div>",l+="    </div>",l+="</div>"},$("#tblEmergencias").DataTable({data:e.data,columns:e.columns,language:{url:baseUrl+"assets/lib/DataTables-1.10.8/Spanish.json"},order:[[0,"desc"]]}),$("#pResultados").css("visibility","visible"),$("#pResultados").slideDown("slow")})},this.guardarForm=function(a){var e=$(a).html();if($(a).attr("disabled",!0).html('Guardando... <i class="fa fa-spin fa-spinner"></i>'),!Utils.validaForm("frmEditarEmergencia"))return!1;var i=$("#frmEditarEmergencia").serialize();$.post(siteUrl+"emergencia/editarEmergencia",i,function(i){1==i?bootbox.dialog({title:"Resultado de la operacion",message:"Se ha editado correctamente",buttons:{danger:{label:"Cerrar",className:"btn-info",callback:function(){$(a).attr("disabled",!1).html(e),location.reload()}}}}):bootbox.dialog({title:"Resultado de la operacion",message:"Error al editar",buttons:{danger:{label:"Cerrar",className:"btn-danger",callback:function(){$(a).attr("disabled",!1).html(e)}}}})})},this.limpiar=function(){$("#frmEditarEmergencia")[0].reset(),$("#iComunas").picklist("destroy"),$("#iComunas").picklist()},this.iniciarUpload=function(){var a=$("#ala_ia_id").val();$("#iDocMaterial").fileinput({language:"es",uploadUrl:siteUrl+"archivo/subir/tipo/5/id/"+a,uploadAsync:!0,multiple:!0,initialCaption:"Seleccione archivos y luego presione subir",allowedFileTypes:["image","html","text","video","audio","flash","object"]})},this.dibujaTablaDocs=function(){var a=$("#ala_ia_id").val();$("#tabla_doc").dataTable().fnDestroy(),$("#tabla_doc").dataTable({ajax:{url:siteUrl+"archivo/getDocs/id/"+a+"/tipo/5",type:"POST",async:!0},language:{url:baseUrl+"assets/lib/DataTables-1.10.8/Spanish.json"},aoColumns:[null,null,null,{sClass:"text-center"}]}),$("#tabla_doc").wrap("<div class='col-sm-12' style='padding-left:0px !important;'></div>")}}).apply(EmergenciaEditar);