var Dashboard=Class({content:"",__construct:function(){$.getScript(baseUrl+"assets/js/modulo/emergencia/form-emergencias-cerrar.js"),$.getScript(baseUrl+"assets/js/modulo/home/form-emergencias-cerrar-dashboard.js"),this.loadDashboard(),this.bindBtnEmergenciaCerrar(),this.bindBtnEmergenciaEditar()},loadDashboard:function(){this.loadGraficoEmergenciasMes(),this.loadGraficoEmergenciasTipo(),this.loadCalendario(),this.loadGrid()},loadGrid:function(){this.loadGridEmergencia(),this.loadGridAlarma()},loadGridAlarma:function(){var a={desde:$("#fecha_desde").val(),hasta:$("#fecha_hasta").val()};$.ajax({dataType:"html",cache:!1,async:!0,data:a,type:"post",url:siteUrl+"home/ajax_grilla_alarmas",error:function(a,e,r){},success:function(a){$("#contendor-grilla-alarma").html(a)}})},loadGridEmergencia:function(){var a={desde:$("#fecha_desde").val(),hasta:$("#fecha_hasta").val()};$.ajax({dataType:"html",cache:!1,async:!0,data:a,type:"post",url:siteUrl+"home/ajax_grilla_emergencias",error:function(a,e,r){},success:function(a){$("#contendor-grilla-emergencia").html(a)}})},loadCalendario:function(){var a=new Date;a.getDate(),a.getMonth(),a.getFullYear();$("#calendar").fullCalendar({header:{left:"prev,next today",center:"title",right:"month,agendaWeek,agendaDay"},lang:"es",editable:!1,droppable:!1,eventSources:[{url:siteUrl+"home/json_eventos_calendario_alertas",type:"POST",error:function(){alert("Ha ocurrido un error al cargar las alarmas al calendario!")},color:"orange",textColor:"black"},{url:siteUrl+"home/json_eventos_calendario_emergencias",type:"POST",error:function(){alert("Ha ocurrido un error al cargar las emergencias al calendario!")},color:"red",textColor:"white"}]})},loadGraficoEmergenciasMes:function(){$.ajax({dataType:"json",cache:!1,async:!0,data:"",type:"post",url:siteUrl+"home/json_cantidad_emergencia_mes",error:function(a,e,r){},success:function(a){if(a.correcto){var e=["En","Feb","Mar","Abr","May","Jun","Jul","Ago","Sep","Oct","Nov","Dic"];Morris.Line({element:"morris-chart-line",data:a.data,xkey:"m",hideHover:!0,ykeys:a.ykeys,labels:a.labels,xLabelFormat:function(a){return e[a.getMonth()]},smooth:!1,resize:!1})}}})},loadGraficoEmergenciasTipo:function(){$.ajax({dataType:"json",cache:!1,async:!0,data:"",type:"post",url:siteUrl+"home/json_cantidad_emergencia_por_tipo",error:function(a,e,r){},success:function(a){if(a.correcto){var e=a.data;$.plot($("#flot-chart-pie"),e,{series:{pie:{show:!0}},grid:{hoverable:!0},tooltip:!0,tooltipOpts:{content:"%p.0%, %s",shifts:{x:20,y:0},defaultTheme:!1}})}}})},bindBtnEmergenciaCerrar:function(){$(".emergencia-cerrar").livequery(function(){$(this).click(function(){var a=$(this).attr("data"),e=new FormEmergenciasCerrarDashboard(a);e.mostrarFormulario()})})},bindBtnEmergenciaEditar:function(){var a=this;$(".emergencia-editar").livequery(function(){$(this).click(function(){var e=$(this).attr("data");a.limpiarVista(),a.content=$("#contenedor-home").html(),$("#contenedor-home").fadeOut(function(){$(this).html('<div class="text-center"><i class="fa fa-spin fa-spinner fa-5x"></i></div>').fadeIn(function(){$(this).load(siteUrl+"emergencia/editar/id/"+e)})})})}),$("#btnCancelar").livequery(function(){$(this).click(function(){$("#contenedor-home").fadeOut(function(){$(this).html('<div class="text-center"><i class="fa fa-spin fa-spinner fa-5x"></i></div>').fadeIn(function(){$(this).html(a.content),a.loadDashboard()})})})})},limpiarVista:function(){var a='<div class="col-lg-12 text-center"><i class="fa fa-4x fa-spin fa-spinner"></i></div>';$("#calendar").html(""),$("#morris-chart-line").html(""),$("#contendor-grilla-alarma").html(a),$("#contendor-grilla-emergencia").html(a)}});$(document).ready(function(){new Dashboard});