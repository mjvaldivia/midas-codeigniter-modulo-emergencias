var Alarma={};(function(){this.inicioIngreso=function(){$("#iTiposEmergencias").jCombo(siteUrl+"alarma/jsonTiposEmergencias"),$("#iComunas").jCombo(siteUrl+"session/obtenerJsonComunas",{handlerLoad:function(){$("#iComunas").picklist()},initial_text:null}),$("#fechaEmergencia, #fechaRecepcion").datetimepicker({format:"DD-MM-YYYY hh:mm"}),$("#iTiposEmergencias").change(function(){15==$("#iTiposEmergencias").val()?$("#btnSiguiente").html("Siguiente Paso"):$("#btnSiguiente").html("Aceptar")})},this.inicioListado=function(){$("#iTiposEmergencias").jCombo(siteUrl+"alarma/jsonTiposEmergencias"),$("#iEstadoAlarma").jCombo(siteUrl+"alarma/jsonEstadosAlarmas"),$("#btnBuscarAlarmas").click(this.eventoBtnBuscar),$(window).resize(function(){$("table").css("width","100%")})},this.eventoBtnBuscar=function(){var a=siteUrl+"alarma/jsonAlarmasDT",e=$("#iAnio").val(),i=$("#iTiposEmergencias").val(),s=$("#iEstadoAlarma").val();parseInt(e)&&(a+="/anio/"+e),parseInt(i)&&(a+="/tipoEmergencia/"+i),parseInt(s)&&(a+="/estado/"+s);var l=$("#tblAlarmas").DataTable();l.destroy(),$("#tblAlarmas").empty(),$.get(a).done(function(a){var e=JSON.parse(a);e.columns[0].mRender=function(a,e,i){var s="",l="";switch(parseInt(i.tip_ia_id)){case 1:case 2:l="incendio";break;case 3:l="quimico";break;case 4:l="meteorologico";break;case 5:l="sismo";break;case 6:l="tsunami";break;case 7:l="volcan";break;case 8:l="sequias";break;case 9:case 10:l="accidente";break;case 11:l="terrorista";break;case 12:case 13:l="salud";break;case 15:l="radiologica";break;case 14:l="otro"}var s="";return s+='<div class="col-md-12 shadow" style="padding: 10px;">',s+='    <div class="col-md-2 text-center"><div class=\''+l+"'/></div></div>",s+='    <div class="col-md-8">',s+='        <div class="form-group col-md-12">',s+='            <label for="" class="col-md-4 control-label">Fecha de la emergencia:</label>',s+='            <div class="col-md-8">',s+="                <p>"+i.ala_d_fecha_emergencia+"</p>",s+="            </div>",s+="        </div>",s+='        <div class="form-group col-md-12">',s+='            <label for="" class="col-md-4 control-label">Nombre de la emergencia:</label>',s+='            <div class="col-md-8">',s+="                <p>"+i.ala_c_nombre_emergencia+"</p>",s+="            </div>",s+="        </div>",s+='        <div class="form-group col-md-12">',s+='            <label for="" class="col-md-4 control-label">Tipo de la emergencia:</label>',s+='            <div class="col-md-8">',s+="                <p>"+i.ala_c_tipo_emergencia+"</p>",s+="            </div>",s+="        </div>",s+='        <div class="form-group col-md-12">',s+='            <label for="" class="col-md-4 control-label">Lugar de la emergencia:</label>',s+='            <div class="col-md-8">',s+="                <p>"+i.ala_c_lugar_emergencia+"</p>",s+="            </div>",s+="        </div>",s+="    </div>",s+='    <div class="col-md-2 text-center">',s+='       <div class="btn-group">',s+='           <a title="Generar emergencia" class="btn btn-default" onclick=Alarma.generaEmergencia('+i.ala_ia_id+"); >",s+='               <i class="fa fa-exclamation-triangle"></i>',s+="            </a>",s+='           <a title="Editar" class="btn btn-default">',s+='               <i class="fa fa-pencil"></i>',s+="           </a>",s+='           <a title="Eliminar" class="btn btn-default">',s+='               <i class="fa fa-trash"></i>',s+="           </a>",s+="       </div>",s+="    </div>",s+="</div>"},$("#tblAlarmas").DataTable({data:e.data,columns:e.columns,language:{url:baseUrl+"assets/lib/DataTables-1.10.8/Spanish.json"},order:[[0,"desc"]]}),$("#pResultados").css("visibility","visible"),$("#pResultados").slideDown("slow")})},this.guardarForm=function(){if(!Utils.validaForm("frmIngresoAlarma"))return!1;var a=$("#frmIngresoAlarma").serialize();$.post(siteUrl+"alarma/guardaAlarma",a,function(a){var e=jQuery.parseJSON(a);e.ala_ia_id>0?bootbox.dialog({title:"Resultado de la operacion",message:"Se ha insertado correctamente<br>Estado email: "+e.res_mail,buttons:{danger:{label:"Cerrar",className:"btn-info",callback:function(){var e=$("#iTiposEmergencias").val();15==e?location.href=siteUrl+"alarma/paso2/id/"+a+"/tip_ia_id/"+e:Alarma.limpiar()}}}}):bootbox.dialog({title:"Resultado de la operacion",message:"Error al insertar",buttons:{danger:{label:"Cerrar",className:"btn-danger"}}})})},this.generaEmergencia=function(a){window.open(siteUrl+"emergencia/generaEmergencia/id/"+a,"_blank")},this.limpiar=function(){$("#frmIngresoAlarma")[0].reset(),$("#iComunas").picklist("destroy"),$("#iComunas").picklist()}}).apply(Alarma);