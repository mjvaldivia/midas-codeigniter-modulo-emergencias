var Layer={};(function(){this.initList=function(){$("#tblCapas").DataTable({ajax:{url:siteUrl+"capas/getCapas",type:"POST",async:!0},language:{url:baseUrl+"assets/lib/DataTables-1.10.8/Spanish.json"}})},this.initSave=function(){$("#input-icon").fileinput({language:"es",multiple:!1,uploadAsync:!0,initialCaption:"Seleccione Icono",allowedFileTypes:["image"],uploadUrl:siteUrl+"emergencia/subir_IconTemp",dropZoneTitle:""}),$("#input-capa").fileinput({language:"es",multiple:!0,uploadAsync:!0,initialCaption:"Seleccione una o varias capas GeoJson",uploadUrl:siteUrl+"emergencia/subir_CapaTemp"}),$("#input-icon").on("filebatchuploadsuccess",function(a,e){$("#icon").val(e.response.nombre_cache_id),$("#img_icon").attr("src",baseUrl+""+e.response.ruta)}),$("#iCategoria").jCombo(siteUrl+"visor/obtenerJsonCatCoberturas"),$("#input-capa").on("filebatchuploadsuccess",function(a,e){if(0==e.response.uploaded){var s="El (los) siguiente(s) archivos no son válidos:<br>";$.each(e.response.error_filenames,function(a,e){s+="-"+e+"<br>"}),bootbox.dialog({title:"Resultado de la operacion",message:s,buttons:{danger:{label:"Cerrar",className:"btn-danger"}}})}if(0!=e.response.filenames.length){var o=e.response.properties.data,n=e.response.filenames.data;$("#tabla_propiedades").DataTable().destroy(),$("#tabla_comunas").DataTable().destroy(),$("#tabla_propiedades").DataTable({data:o,language:{url:baseUrl+"assets/lib/DataTables-1.10.8/Spanish.json"},order:[[0,"desc"]],initComplete:function(){$("#div_properties").slideDown("slow")}}),$("#tabla_comunas").DataTable({data:n,language:{url:baseUrl+"assets/lib/DataTables-1.10.8/Spanish.json"},order:[[0,"desc"]],initComplete:function(){$(".iComunas").jCombo(siteUrl+"session/obtenerJsonComunas"),$("#div_comunas").slideDown("slow")}})}})},this.guardar=function(){if(Utils.validaForm("form_capas")){var a=$("#form_capas").serialize();a+="&items="+parseInt($("#tabla_comunas tr").length-1),$.post(siteUrl+"visor/guardarCapa",a,function(a){1==a?bootbox.dialog({title:"Resultado de la operacion",message:"Se ha guardado con éxito.",buttons:{danger:{label:"Aceptar",className:"btn-info",callback:function(){location.reload()}}}}):bootbox.dialog({title:"Resultado de la operacion",message:"Una o más capas no se han guardado",buttons:{danger:{label:"Cerrar",className:"btn-danger"}}})})}}}).apply(Layer);