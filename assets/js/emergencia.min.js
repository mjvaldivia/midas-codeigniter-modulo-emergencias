var Emergencia={};(function(){this.inicioIngreso=function(){var a=$("#ala_ia_id").val();$("#iTiposEmergencias").jCombo(siteUrl+"emergencia/jsonTiposEmergencias"),$("#iComunas").jCombo(siteUrl+"session/obtenerJsonComunas",{handlerLoad:function(){$.getJSON(siteUrl+"emergencia/getAlarma/id/"+a,function(a){var e=a.comunas;if(null!==e){var i=e.split(",");$("#iComunas").picklist({value:i})}else $("#iComunas").picklist();$("#iNombreInformante").val(a.ala_c_nombre_informante),$("#iTelefonoInformante").val(a.ala_c_telefono_informante),$("#iNombreEmergencia").val(a.ala_c_nombre_emergencia),$("#iTiposEmergencias").val(a.tip_ia_id),$("#iLugarEmergencia").val(a.ala_c_lugar_emergencia),$("#fechaEmergencia").val(a.ala_d_fecha_emergencia),$("#usuarioRecepciona").val(a.usuario),$("#fechaRecepcion").val(a.ala_d_fecha_recepcion),$("#iObservacion").val(a.ala_c_observacion)})},initial_text:null}),$("#fechaEmergencia, #fechaRecepcion").datetimepicker({format:"DD-MM-YYYY hh:mm"})},this.inicioListado=function(){$("#iTiposEmergencias").jCombo(siteUrl+"emergencia/jsonTiposEmergencias"),$("#btnBuscar").click(this.eventoBtnBuscar),$(window).resize(function(){$("table").css("width","100%")}),this.eventoBtnBuscar()},this.eventoBtnBuscar=function(){var a=siteUrl+"emergencia/jsonEmergenciasDT",e=$("#iAnio").val(),i=$("#iTiposEmergencias").val();parseInt(e)&&(a+="/anio/"+e),parseInt(i)&&(a+="/tipoEmergencia/"+i);var o=$("#tblEmergencias").DataTable();o.destroy(),$("#tblEmergencias").empty(),$.get(a).done(function(a){var e=JSON.parse(a);e.columns[0].mRender=function(a,e,i){var o="";switch(parseInt(i.tip_ia_id)){case 1:case 2:o='<i class="glyphicon glyphicon-fire icono"></i>';break;case 3:o='<i class="fa fa-4x fa-flask icono"></i>';break;case 4:o='<i class="fa fa-4x fa-cloud icono"></i>';break;case 5:o='<i class="fa fa-4x fa-bullseye icono"></i>';break;case 6:o='<i class="fa fa-4x fa-life-ring icono"></i>';break;case 7:o='<i class="fa fa-4x fa-globe icono"></i>';break;case 8:o='<i class="glyphicon glyphicon-tint icono"></i>';break;case 9:case 10:o='<i class="fa fa-4x fa-medkit icono"></i>';break;case 11:o='<i class="fa fa-4x fa-bomb icono"></i>';break;case 12:case 13:o='<i class="fa fa-4x fa-user-md icono"></i>';break;case 15:o='<i class="fa fa-4x fa-bolt icono"></i>';break;case 14:o='<i class="fa fa-4x fa-bullhorn icono"></i>'}var l="";return l+='<div class="col-md-12 shadow" style="padding: 10px;">',l+='    <div class="col-md-2 text-center">'+o+"</div>",l+='    <div class="col-md-8">',l+='        <div class="form-group col-md-12">',l+="           <label class='col-md-4' style='text-align: right; margin-bottom: 0 !important;'>Fecha:</label>",l+='            <div class="col-md-8">',l+="                "+i.eme_d_fecha_emergencia,l+="            </div>",l+="        </div>",l+='        <div class="form-group col-md-12">',l+="            <label class='col-md-4' style='text-align: right; margin-bottom: 0 !important;'>Nombre:</label>",l+='            <div class="col-md-8">',l+="                "+i.eme_c_nombre_emergencia,l+="            </div>",l+="        </div>",l+='        <div class="form-group col-md-12">',l+="            <label class='col-md-4' style='text-align: right; margin-bottom: 0 !important;'>Tipo:</label>",l+='            <div class="col-md-8">',l+="                "+i.eme_c_tipo_emergencia,l+="            </div>",l+="        </div>",l+='        <div class="form-group col-md-12">',l+="            <label class='col-md-4' style='text-align: right; margin-bottom: 0 !important;'>Lugar:</label>",l+='            <div class="col-md-8">',l+="                "+i.eme_c_lugar_emergencia,l+="            </div>",l+="        </div>",l+="    </div>",l+='    <div class="col-md-2 text-center">',l+='       <div class="btn-group">',l+="     <a data-toggle='modal' class='btn btn-default modal-sipresa' data-style='width:80%;' data-href='"+siteUrl+"visor/reporte/id/"+i.eme_ia_id+"/ala_ia_id/"+i.ala_ia_id+"' data-title='Administracion del Reporte' data-success='exportarMapa("+i.eme_ia_id+");' data-target='#modal_"+i.eme_ia_id+"'><i class='fa fa-fa2x fa-file-text-o'></i></a>",l+='           <a title="Visor" class="btn btn-default" href=\''+siteUrl+"visor/index/id/"+i.eme_ia_id+"' target='_blank'>",l+='               <i class="fa fa-fa2x fa-globe"></i>',l+="           </a>",l+='           <a title="Editar" class="btn btn-default" onclick=Emergencia.editarEmergencia('+i.eme_ia_id+");>",l+='               <i class="fa fa-fa2x fa-pencil"></i>',l+="           </a>",l+='           <a title="Eliminar" class="btn btn-default" onclick=Emergencia.eliminarEmergencia('+i.eme_ia_id+");>",l+='               <i class="fa fa-fa2x fa-trash"></i>',l+="           </a>",l+="       </div>",l+="    </div>",l+="</div>"},$("#tblEmergencias").DataTable({data:e.data,columns:e.columns,language:{url:baseUrl+"assets/lib/DataTables-1.10.8/Spanish.json"},order:[[0,"desc"]]}),$("#pResultados").css("visibility","visible"),$("#pResultados").slideDown("slow")})},this.openIframe=function(a){var e=document.createElement("iframe");e.style.display="block",e.id=a,e.width=0,e.heigth=0,e.src=siteUrl+"visor/loadExportMap/id/"+a,document.body.appendChild(e)},this.closeIframe=function(a){var e=document.getElementById(a);e.parentNode.removeChild(e)},this.cargando=function(){$(".cargando").fadeToggle("slow")},this.guardarForm=function(){if(!Utils.validaForm("frmIngresoEmergencia"))return!1;var a=$("#frmIngresoEmergencia").serialize();$.post(siteUrl+"emergencia/ingreso",a,function(a){var e=jQuery.parseJSON(a);e.eme_ia_id>0?bootbox.dialog({title:"Resultado de la operacion",message:"Se ha insertado correctamente<br>Estado email: "+e.res_mail,buttons:{danger:{label:"Cerrar",className:"btn-info",callback:function(){location.reload()}}}}):bootbox.dialog({title:"Resultado de la operacion",message:"Error al insertar",buttons:{danger:{label:"Cerrar",className:"btn-danger"}}})})},this.rechazar=function(){var a="ala_ia_id="+$("#ala_ia_id").val();$.post(siteUrl+"emergencia/rechaza",a,function(a){1==a?bootbox.dialog({title:"Resultado de la operacion",message:"Se ha rechazado correctamente",buttons:{danger:{label:"Cerrar",className:"btn-info",callback:function(){location.reload()}}}}):bootbox.dialog({title:"Resultado de la operacion",message:"Error al rechazar",buttons:{danger:{label:"Cerrar",className:"btn-danger"}}})})},this.editarEmergencia=function(a){window.open(siteUrl+"emergencia/editar/id/"+a,"_blank")},this.eliminarEmergencia=function(a){bootbox.dialog({title:"Eliminar elemento",message:"¿Está seguro que desea eliminar esta emergencia?",buttons:{success:{label:"Aceptar",className:"btn-primary",callback:function(){$.get(siteUrl+"emergencia/eliminarEmergencia/id/"+a).done(function(a){0==a?bootbox.dialog({title:"Resultado de la operacion",message:"Se eliminó correctamente",buttons:{danger:{label:"Cerrar",className:"btn-info",callback:function(){Emergencia.eventoBtnBuscar()}}}}):bootbox.dialog({title:"Resultado de la operacion",message:"Error al eliminar",buttons:{danger:{label:"Cerrar",className:"btn-danger"}}})})}},danger:{label:"Cancelar",className:"btn-default"}}})}}).apply(Emergencia);