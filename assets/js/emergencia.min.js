var content;$(document).ready(function(){$("#btnCancelar").livequery(function(){$(this).click(function(){Emergencia.cancelarEdicion()})})});var Emergencia={};(function(){this.inicioIngreso=function(){var a=$("#ala_ia_id").val();$("#iTiposEmergencias").jCombo(siteUrl+"emergencia/jsonTiposEmergencias"),$("#iComunas").jCombo(siteUrl+"session/obtenerJsonComunas",{handlerLoad:function(){$.getJSON(siteUrl+"emergencia/getAlarma/id/"+a,function(a){var e=a.comunas;if(null!==e){var i=e.split(",");$("#iComunas").picklist({value:i})}else $("#iComunas").picklist();$("#iNombreInformante").val(a.ala_c_nombre_informante),$("#iTelefonoInformante").val(a.ala_c_telefono_informante),$("#iNombreEmergencia").val(a.ala_c_nombre_emergencia),$("#iTiposEmergencias").val(a.tip_ia_id),$("#iLugarEmergencia").val(a.ala_c_lugar_emergencia),$("#fechaEmergencia").val(a.ala_d_fecha_emergencia),$("#usuarioRecepciona").val(a.usuario),$("#fechaRecepcion").val(a.ala_d_fecha_recepcion),$("#iObservacion").val(a.ala_c_observacion)})},initial_text:null}),$("#fechaEmergencia, #fechaRecepcion").datetimepicker({format:"DD-MM-YYYY hh:mm"})},this.inicioListado=function(){$("#iTiposEmergencias").jCombo(siteUrl+"emergencia/jsonTiposEmergencias"),$(window).resize(function(){$("table").css("width","100%")}),this.eventoBtnBuscar()},this.eventoBtnBuscar=function(){var a=$("#btnBuscar").html();$("#btnBuscar").attr("disabled",!0).html('Buscando... <i class="fa fa-spin fa-spinner"></i>');var e=siteUrl+"emergencia/jsonEmergenciasDT",i=$("#iAnio").val(),t=$("#iTiposEmergencias").val(),n=$("#iEstadoEmergencias").val();parseInt(i)&&(e+="/anio/"+i),parseInt(t)&&(e+="/tipoEmergencia/"+t),parseInt(n)&&(e+="/estado_emergencia/"+n);var r=$("#tblEmergencias").DataTable();r.destroy(),$("#tblEmergencias").empty(),$.get(e).done(function(e){var i=JSON.parse(e);i.columns[0].mRender=function(a,e,i){var t="";switch(parseInt(i.tip_ia_id)){case 1:case 2:t='<i class="glyphicon glyphicon-fire icono"></i>';break;case 3:t='<i class="fa fa-4x fa-flask icono"></i>';break;case 4:t='<i class="fa fa-4x fa-cloud icono"></i>';break;case 5:t='<i class="fa fa-4x fa-bullseye icono"></i>';break;case 6:t='<i class="fa fa-4x fa-life-ring icono"></i>';break;case 7:t='<i class="fa fa-4x fa-globe icono"></i>';break;case 8:t='<i class="glyphicon glyphicon-tint icono"></i>';break;case 9:case 10:t='<i class="fa fa-4x fa-medkit icono"></i>';break;case 11:t='<i class="fa fa-4x fa-bomb icono"></i>';break;case 12:case 13:t='<i class="fa fa-4x fa-user-md icono"></i>';break;case 15:t='<i class="fa fa-4x fa-bolt icono"></i>';break;case 14:t='<i class="fa fa-4x fa-bullhorn icono"></i>'}var n="";return n+='<div class="col-md-12 shadow" style="padding: 10px;">',n+='    <div class="col-md-2 text-center">'+t+"</div>",n+='    <div class="col-md-7">',n+='        <div class="form-group col-md-12">',n+="           <label class='col-md-4' style='text-align: right; margin-bottom: 0 !important;'>Fecha:</label>",n+='            <div class="col-md-8">',n+="                "+i.eme_d_fecha_emergencia,n+="            </div>",n+="        </div>",n+='        <div class="form-group col-md-12">',n+="            <label class='col-md-4' style='text-align: right; margin-bottom: 0 !important;'>Nombre:</label>",n+='            <div class="col-md-8">',n+="                "+i.eme_c_nombre_emergencia,n+="            </div>",n+="        </div>",n+='        <div class="form-group col-md-12">',n+="            <label class='col-md-4' style='text-align: right; margin-bottom: 0 !important;'>Tipo:</label>",n+='            <div class="col-md-8">',n+="                "+i.eme_c_tipo_emergencia,n+="            </div>",n+="        </div>",n+='        <div class="form-group col-md-12">',n+="            <label class='col-md-4' style='text-align: right; margin-bottom: 0 !important;'>Lugar:</label>",n+='            <div class="col-md-8">',n+="                "+i.eme_c_lugar_emergencia,n+="            </div>",n+="        </div>",n+="    </div>",n+='    <div class="col-md-3 text-center">',n+='       <div class="btn-group">',n+="     <a data-toggle='modal' class='btn btn-primary modal-sipresa' data-style='width:80%;' data-href='"+siteUrl+"visor/reporte/id/"+i.eme_ia_id+"/ala_ia_id/"+i.ala_ia_id+"' data-title='Administracion del Reporte' data-success='exportarMapa("+i.eme_ia_id+");' data-target='#modal_"+i.eme_ia_id+"'><i class='fa fa-fa2x fa-file-text-o'></i></a>",n+='           <a data-toggle="tooltip" data-toogle-param="arriba" title="Visor" class="btn btn-primary" href=\''+siteUrl+"visor/index/id/"+i.eme_ia_id+"' target='_blank'>",n+='               <i class="fa fa-fa2x fa-globe"></i>',n+="           </a>",n+='           <a data-toggle="tooltip" data-toogle-param="arriba" title="Cerrar emergencia" class="btn btn-primary" onclick=Emergencia.cerrar('+i.eme_ia_id+");>",n+='               <i class="fa fa-fa2x fa-check"></i>',n+="           </a>",n+='           <a data-toggle="tooltip" data-toogle-param="arriba" title="Editar" class="btn btn-primary" onclick=Emergencia.editarEmergencia('+i.eme_ia_id+");>",n+='               <i class="fa fa-fa2x fa-pencil"></i>',n+="           </a>",n+='           <a data-toggle="tooltip" data-toogle-param="arriba" title="Eliminar" class="btn btn-primary" onclick=Emergencia.eliminarEmergencia('+i.eme_ia_id+");>",n+='               <i class="fa fa-fa2x fa-trash"></i>',n+="           </a>",n+="       </div>",n+="    </div>",n+="</div>"},$("#tblEmergencias").DataTable({data:i.data,columns:i.columns,language:{url:baseUrl+"assets/lib/DataTables-1.10.8/Spanish.json"},order:[[0,"desc"]]}),$("#pResultados").css("visibility","visible"),$("#pResultados").slideDown("slow"),$("#btnBuscar").attr("disabled",!1).html(a)})},this.openIframe=function(a){var e=document.createElement("iframe");e.style.display="block",e.id=a,e.width=0,e.heigth=0,e.src=siteUrl+"visor/loadExportMap/id/"+a,document.body.appendChild(e)},this.closeIframe=function(a){var e=document.getElementById(a);e.parentNode.removeChild(e)},this.cargando=function(){$(".cargando").fadeToggle("slow")},this.guardarForm=function(){if(!Utils.validaForm("frmIngresoEmergencia"))return!1;var a=$("#frmIngresoEmergencia").serialize();$.post(siteUrl+"emergencia/ingreso",a,function(a){var e=jQuery.parseJSON(a);e.eme_ia_id>0?bootbox.dialog({title:"Resultado de la operacion",message:"Se ha insertado correctamente<br>Estado email: "+e.res_mail,buttons:{danger:{label:"Cerrar",className:"btn-info",callback:function(){location.reload()}}}}):bootbox.dialog({title:"Resultado de la operacion",message:"Error al insertar",buttons:{danger:{label:"Cerrar",className:"btn-danger"}}})})},this.rechazar=function(){var a="ala_ia_id="+$("#ala_ia_id").val();$.post(siteUrl+"emergencia/rechaza",a,function(a){1==a?bootbox.dialog({title:"Resultado de la operacion",message:"Se ha rechazado correctamente",buttons:{danger:{label:"Cerrar",className:"btn-info",callback:function(){location.reload()}}}}):bootbox.dialog({title:"Resultado de la operacion",message:"Error al rechazar",buttons:{danger:{label:"Cerrar",className:"btn-danger"}}})})},this.editarEmergencia=function(a){var e=$("#tblEmergencias").DataTable({destroy:!0});e.destroy(),content=$("#contenedor-emergencia").html(),$("#contenedor-emergencia").fadeOut(function(){$(this).html('<div class="text-center"><i class="fa fa-spin fa-spinner fa-5x"></i></div>').fadeIn(function(){$(this).load(siteUrl+"emergencia/editar/id/"+a)})})},this.eliminarEmergencia=function(a){bootbox.dialog({title:"Eliminar elemento",message:"¿Está seguro que desea eliminar esta emergencia?",buttons:{success:{label:"Aceptar",className:"btn-primary",callback:function(){$.get(siteUrl+"emergencia/eliminarEmergencia/id/"+a).done(function(a){0==a?bootbox.dialog({title:"Resultado de la operacion",message:"Se eliminó correctamente",buttons:{danger:{label:"Cerrar",className:"btn-info",callback:function(){Emergencia.eventoBtnBuscar()}}}}):bootbox.dialog({title:"Resultado de la operacion",message:"Error al eliminar",buttons:{danger:{label:"Cerrar",className:"btn-danger"}}})})}},danger:{label:"Cancelar",className:"btn-default"}}})},this.cancelarEdicion=function(){$("#contenedor-emergencia").fadeOut(function(){$(this).html('<div class="text-center"><i class="fa fa-spin fa-spinner fa-5x"></i></div>').fadeIn(function(){$(this).html(content),Emergencia.inicioListado()})})}}).apply(Emergencia);