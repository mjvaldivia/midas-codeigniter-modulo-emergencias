var Emergencia={};(function(){this.inicioIngreso=function(){var e=$("#ala_ia_id").val();$("#iTiposEmergencias").jCombo(siteUrl+"emergencia/jsonTiposEmergencias"),$("#iComunas").jCombo(siteUrl+"session/obtenerJsonComunas",{handlerLoad:function(){$.getJSON(siteUrl+"emergencia/getAlarma/id/"+e,function(e){var a=e.comunas;if(null!==a){var i=a.split(",");$("#iComunas").picklist({value:i})}else $("#iComunas").picklist();$("#iNombreInformante").val(e.ala_c_nombre_informante),$("#iTelefonoInformante").val(e.ala_c_telefono_informante),$("#iNombreEmergencia").val(e.ala_c_nombre_emergencia),$("#iTiposEmergencias").val(e.tip_ia_id),$("#iLugarEmergencia").val(e.ala_c_lugar_emergencia),$("#fechaEmergencia").val(e.ala_d_fecha_emergencia),$("#usuarioRecepciona").val(e.usuario),$("#fechaRecepcion").val(e.ala_d_fecha_recepcion),$("#iObservacion").val(e.ala_c_observacion)})},initial_text:null}),$("#fechaEmergencia, #fechaRecepcion").datetimepicker({format:"DD-MM-YYYY hh:mm"})},this.inicioListado=function(){$("#iTiposEmergencias").jCombo(siteUrl+"emergencia/jsonTiposEmergencias"),$("#btnBuscar").click(this.eventoBtnBuscar),$(window).resize(function(){$("table").css("width","100%")})},this.eventoBtnBuscar=function(){var e=siteUrl+"emergencia/jsonEmergenciasDT",a=$("#iAnio").val(),i=$("#iTiposEmergencias").val();parseInt(a)&&(e+="/anio/"+a),parseInt(i)&&(e+="/tipoEmergencia/"+i);var l=$("#tblEmergencias").DataTable();l.destroy(),$("#tblEmergencias").empty(),$.get(e).done(function(e){var a=JSON.parse(e);a.columns[0].mRender=function(e,a,i){var l="";return l+='<div class="col-md-12 shadow" style="padding: 10px;">',l+='    <div class="col-md-2 text-center"><img src="'+baseUrl+'assets/img/quimico_ico.png"/></div>',l+='    <div class="col-md-8">',l+='        <div class="form-group col-md-12">',l+='            <label for="" class="col-md-4 control-label">Fecha de la emergencia:</label>',l+='            <div class="col-md-8">',l+="                <p>"+i.eme_d_fecha_emergencia+"</p>",l+="            </div>",l+="        </div>",l+='        <div class="form-group col-md-12">',l+='            <label for="" class="col-md-4 control-label">Nombre de la emergencia:</label>',l+='            <div class="col-md-8">',l+="                <p>"+i.eme_c_nombre_emergencia+"</p>",l+="            </div>",l+="        </div>",l+='        <div class="form-group col-md-12">',l+='            <label for="" class="col-md-4 control-label">Tipo de la emergencia:</label>',l+='            <div class="col-md-8">',l+="                <p>"+i.eme_c_tipo_emergencia+"</p>",l+="            </div>",l+="        </div>",l+='        <div class="form-group col-md-12">',l+='            <label for="" class="col-md-4 control-label">Lugar de la emergencia:</label>',l+='            <div class="col-md-8">',l+="                <p>"+i.eme_c_lugar_emergencia+"</p>",l+="            </div>",l+="        </div>",l+="    </div>",l+='    <div class="col-md-2 text-center">',l+='       <div class="btn-group">',l+='           <a title="Visor" class="btn btn-default" href=\''+siteUrl+"visor/index/id/"+i.eme_ia_id+"' target='_blank'>",l+='               <i class="fa fa-globe"></i>',l+="           </a>",l+='           <a title="Editar" class="btn btn-default" onclick=Emergencia.editarEmergencia('+i.eme_ia_id+");>",l+='               <i class="fa fa-pencil"></i>',l+="           </a>",l+='           <a title="Eliminar" class="btn btn-default">',l+='               <i class="fa fa-trash"></i>',l+="           </a>",l+="       </div>",l+="    </div>",l+="</div>"},$("#tblEmergencias").DataTable({data:a.data,columns:a.columns,language:{url:baseUrl+"assets/lib/DataTables-1.10.8/Spanish.json"},order:[[0,"desc"]]}),$("#pResultados").css("visibility","visible"),$("#pResultados").slideDown("slow")})},this.guardarForm=function(){if(!Utils.validaForm("frmIngresoEmergencia"))return!1;var e=$("#frmIngresoEmergencia").serialize();$.post(siteUrl+"emergencia/ingreso",e,function(e){var a=jQuery.parseJSON(e);a.eme_ia_id>0?bootbox.dialog({title:"Resultado de la operacion",message:"Se ha insertado correctamente<br>Estado email: "+a.res_mail,buttons:{danger:{label:"Cerrar",className:"btn-info",callback:function(){location.reload()}}}}):bootbox.dialog({title:"Resultado de la operacion",message:"Error al insertar",buttons:{danger:{label:"Cerrar",className:"btn-danger"}}})})},this.rechazar=function(){var e="ala_ia_id="+$("#ala_ia_id").val();$.post(siteUrl+"emergencia/rechaza",e,function(e){1==e?bootbox.dialog({title:"Resultado de la operacion",message:"Se ha rechazado correctamente",buttons:{danger:{label:"Cerrar",className:"btn-info",callback:function(){location.reload()}}}}):bootbox.dialog({title:"Resultado de la operacion",message:"Error al rechazar",buttons:{danger:{label:"Cerrar",className:"btn-danger"}}})})},this.editarEmergencia=function(e){window.open(siteUrl+"emergencia/editar/id/"+e,"_blank")}}).apply(Emergencia);