var VisorMapa={mapa:null,telon:null,drawingManager:null};(function(){this.init=function(a){this.telon=$("#mapa").get(0),$(window).resize(this.detectHeight.bind(this));var e={center:new google.maps.LatLng(-33.0507081,-71.6110485),mapTypeId:google.maps.MapTypeId.ROADMAP,zoom:8},n=$.extend(e,a);this.detectHeight.call(this),this.mapa=new google.maps.Map(this.telon,n),this.makeSearchBox.call(this),this.makeDrawManager.call(this)},this.makeDrawManager=function(){var a=this;this.drawingManager=new google.maps.drawing.DrawingManager({drawingMode:google.maps.drawing.OverlayType.MARKER,drawingControl:!1,drawingControlOptions:{position:google.maps.ControlPosition.TOP_CENTER,drawingModes:[google.maps.drawing.OverlayType.MARKER,google.maps.drawing.OverlayType.CIRCLE,google.maps.drawing.OverlayType.POLYGON,google.maps.drawing.OverlayType.POLYLINE,google.maps.drawing.OverlayType.RECTANGLE]},clickable:!1,editable:!0,zIndex:1}),this.drawingManager.setMap(null);var e={ctrlDrawCircle:google.maps.drawing.OverlayType.CIRCLE,ctrlDrawLine:google.maps.drawing.OverlayType.POLYLINE,ctrlDrawRectangle:google.maps.drawing.OverlayType.RECTANGLE,ctrlDrawPolygon:google.maps.drawing.OverlayType.POLYGON,ctrlDrawMarker:google.maps.drawing.OverlayType.MARKER};for(var n in e)!function(e,n){var o=function(){a.drawingManager.setDrawingMode(n),a.drawingManager.setMap(a.mapa);var e=$(this).parents("div").first().find("a.btn");e.removeClass("btn-primary"),e.addClass("btn-success"),$(".ctrlPowerOff").css("display","block"),event.preventDefault(),event.stopPropagation()};$("#"+e).on("click",o)}(n,e[n]);$("#ctrlDrawOFF").click(function(){a.drawingManager.setMap(null);var e=$(this).parents("div").first().find("a.btn");e.removeClass("btn-success"),e.addClass("btn-primary"),$(".ctrlPowerOff").css("display","none")}),google.maps.event.addListener(this.drawingManager,"overlaycomplete",function(){$("#ctrlDrawOFF").click()})},this.loadKML=function(){var a=new google.maps.KmlLayer({url:"http://ssrv.cl/sipresa_test/kml.php",map:this.mapa,suppressInfoWindows:!0,preserveViewport:!1});a.addListener("click",function(a){console.log(a);var e=a.featureData.infoWindowHtml,n=document.getElementById("capture");n.innerHTML=e})},this.detectHeight=function(){$(this.telon).css("height",$("html").height()-$("div.header").height()+"px")},this.makeSearchBox=function(){var a=$("#input-buscador-mapa").get(0),e=new google.maps.places.SearchBox(a),n=this,o=[];this.mapa.controls[google.maps.ControlPosition.TOP_LEFT].push(a),this.mapa.addListener("bounds_changed",function(){e.setBounds(n.mapa.getBounds())}),e.addListener("places_changed",function(){var a=e.getPlaces();if(0!=a.length){o.forEach(function(a){a.setMap(null)}),o=[];var t=new google.maps.LatLngBounds;a.forEach(function(a){var e={url:a.icon,size:new google.maps.Size(71,71),origin:new google.maps.Point(0,0),anchor:new google.maps.Point(17,34),scaledSize:new google.maps.Size(25,25)};o.push(new google.maps.Marker({map:n.mapa,icon:e,title:a.name,position:a.geometry.location})),a.geometry.viewport?t.union(a.geometry.viewport):t.extend(a.geometry.location)}),n.mapa.fitBounds(t)}})}}).apply(VisorMapa);