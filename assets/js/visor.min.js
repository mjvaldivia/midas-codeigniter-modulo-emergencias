var VisorMapa={map:null,canvas:null,emergencyDrawingManager:null,emergencyMarker:null,emergencyRadius:null,otherDrawingManager:null};(function(){var e=function(){var e=$("#iRadioEmergencia").val();$("#iRadioEmergencia").val("0"),$("#mRadioEmergencia").modal("hide"),this.emergencyRadius=new google.maps.Circle({map:this.map,radius:parseInt(e),fillColor:"#FF0000",center:{lat:this.emergencyMarker.position.G,lng:this.emergencyMarker.position.K}})};this.init=function(a){this.canvas=$("#mapa").get(0),$(window).resize(this.detectHeight.bind(this));var n={center:new google.maps.LatLng(-33.0507081,-71.6110485),mapTypeId:google.maps.MapTypeId.ROADMAP,zoom:8},i=$.extend(n,a);this.detectHeight.call(this),this.map=new google.maps.Map(this.canvas,i),this.makeSearchBox.call(this),this.map.addListener("click",function(e){console.log(e)}),this.makeDrawManager.call(this),$("#btnGuardarRadioEmergencia").click(e.bind(this))},this.makeDrawManager=function(){var e=this;this.emergencyDrawingManager=new google.maps.drawing.DrawingManager({drawingMode:google.maps.drawing.OverlayType.MARKER,drawingControl:!1,drawingControlOptions:{position:google.maps.ControlPosition.TOP_CENTER,drawingModes:[google.maps.drawing.OverlayType.MARKER]},clickable:!1,editable:!0,zIndex:1}),this.emergencyDrawingManager.setMap(null),function(a,n){var i=function(){e.emergencyDrawingManager.setDrawingMode(n),e.emergencyDrawingManager.setMap(e.map);var a=$(this).parents("div").first().find("a.btn");a.removeClass("btn-primary"),a.addClass("btn-success"),$(".ctrlPowerOff").css("display","block"),event.preventDefault(),event.stopPropagation()};$("#"+a).on("click",i)}("ctrlDrawMarker",google.maps.drawing.OverlayType.MARKER),$("#ctrlDrawOFF").click(function(){e.emergencyDrawingManager.setMap(null);var a=$(this).parents("div").first().find("a.btn");a.removeClass("btn-success"),a.addClass("btn-primary"),$(".ctrlPowerOff").css("display","none")}),google.maps.event.addListener(this.emergencyDrawingManager,"overlaycomplete",function(a){if(e.emergencyMarker&&(e.emergencyMarker.setMap(null),e.emergencyRadius&&e.emergencyRadius.setMap(null)),a.type==google.maps.drawing.OverlayType.MARKER){var n=a.overlay;e.emergencyMarker=n,$("#mRadioEmergencia").modal("show")}$("#ctrlDrawOFF").click()})},this.loadKML=function(){var e=new google.maps.KmlLayer({url:"http://ssrv.cl/sipresa_test/kml.php",map:this.map,suppressInfoWindows:!0,preserveViewport:!1});e.addListener("click",function(e){console.log(e);var a=e.featureData.infoWindowHtml,n=document.getElementById("capture");n.innerHTML=a})},this.detectHeight=function(){$(this.telon).css("height",$("html").height()-$("div.header").height()+"px")},this.makeSearchBox=function(){var e=$("#input-buscador-mapa").get(0),a=new google.maps.places.SearchBox(e),n=this,i=[];this.map.controls[google.maps.ControlPosition.TOP_LEFT].push(e),this.map.addListener("bounds_changed",function(){a.setBounds(n.map.getBounds())}),a.addListener("places_changed",function(){var e=a.getPlaces();if(0!=e.length){i.forEach(function(e){e.setMap(null)}),i=[];var r=new google.maps.LatLngBounds;e.forEach(function(e){var a={url:e.icon,size:new google.maps.Size(71,71),origin:new google.maps.Point(0,0),anchor:new google.maps.Point(17,34),scaledSize:new google.maps.Size(25,25)};i.push(new google.maps.Marker({map:n.map,icon:a,title:e.name,position:e.geometry.location})),e.geometry.viewport?r.union(e.geometry.viewport):r.extend(e.geometry.location)}),n.map.fitBounds(r)}})}}).apply(VisorMapa);