var VisorMapa={mapa:null,telon:null,drawingManager:null};(function(){this.init=function(e){this.telon=$("#mapa").get(0),$(window).resize(this.detectHeight.bind(this));var a={center:new google.maps.LatLng(-33.0507081,-71.6110485),mapTypeId:google.maps.MapTypeId.ROADMAP,zoom:8},n=$.extend(a,e);this.detectHeight.call(this),this.mapa=new google.maps.Map(this.telon,n),this.makeSearchBox.call(this),this.makeDrawManager.call(this)},this.makeDrawManager=function(){var e=this;this.drawingManager=new google.maps.drawing.DrawingManager({drawingMode:google.maps.drawing.OverlayType.MARKER,drawingControl:!1,drawingControlOptions:{position:google.maps.ControlPosition.TOP_CENTER,drawingModes:[google.maps.drawing.OverlayType.MARKER,google.maps.drawing.OverlayType.CIRCLE,google.maps.drawing.OverlayType.POLYGON,google.maps.drawing.OverlayType.POLYLINE,google.maps.drawing.OverlayType.RECTANGLE]},polygonOptions:{fillColor:"#FF0000"},circleOptions:{fillColor:"#FF0000"},polylineOptions:{strokeColor:"#FF0000"},rectangleOptions:{fillColor:"#FF0000"},clickable:!1,editable:!0,zIndex:1}),this.drawingManager.setMap(null);var a={ctrlDrawLine:google.maps.drawing.OverlayType.POLYLINE};for(var n in a)!function(a,n){var o=function(){e.drawingManager.setDrawingMode(n),e.drawingManager.setMap(e.mapa);var a=$(this).parents("div").first().find("a.btn");a.removeClass("btn-primary"),a.addClass("btn-success"),$(".ctrlPowerOff").css("display","block"),event.preventDefault(),event.stopPropagation()};$("#"+a).on("click",o)}(n,a[n]);$("#ctrlDrawOFF").click(function(){e.drawingManager.setMap(null);var a=$(this).parents("div").first().find("a.btn");a.removeClass("btn-success"),a.addClass("btn-primary"),$(".ctrlPowerOff").css("display","none")}),google.maps.event.addListener(this.drawingManager,"overlaycomplete",function(){$("#ctrlDrawOFF").click()})},this.loadKML=function(){var e=new google.maps.KmlLayer({url:"http://ssrv.cl/sipresa_test/kml.php",map:this.mapa,suppressInfoWindows:!0,preserveViewport:!1});e.addListener("click",function(e){console.log(e);var a=e.featureData.infoWindowHtml,n=document.getElementById("capture");n.innerHTML=a})},this.detectHeight=function(){$(this.telon).css("height",$("html").height()-$("div.header").height()+"px")},this.makeSearchBox=function(){var e=$("#input-buscador-mapa").get(0),a=new google.maps.places.SearchBox(e),n=this,o=[];this.mapa.controls[google.maps.ControlPosition.TOP_LEFT].push(e),this.mapa.addListener("bounds_changed",function(){a.setBounds(n.mapa.getBounds())}),a.addListener("places_changed",function(){var e=a.getPlaces();if(0!=e.length){o.forEach(function(e){e.setMap(null)}),o=[];var t=new google.maps.LatLngBounds;e.forEach(function(e){var a={url:e.icon,size:new google.maps.Size(71,71),origin:new google.maps.Point(0,0),anchor:new google.maps.Point(17,34),scaledSize:new google.maps.Size(25,25)};o.push(new google.maps.Marker({map:n.mapa,icon:a,title:e.name,position:e.geometry.location})),e.geometry.viewport?t.union(e.geometry.viewport):t.extend(e.geometry.location)}),n.mapa.fitBounds(t)}})}}).apply(VisorMapa);